<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>U.S. Standard Atmosphere 1976 Calculator</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial,
          'Apple Color Emoji',
          'Segoe UI Emoji';
        margin: 16px;
        line-height: 1.6;
      }
      fieldset {
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 12px;
        margin: 0 0 12px;
      }
      legend {
        padding: 0 6px;
        font-weight: 600;
      }

      .control {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1 1 auto;
        min-width: 0;
      }
      .control label {
        min-width: 9.5rem;
      }
      .control input {
        flex: 1 1 12rem;
        min-width: 0;
        width: 100%;
        padding: 8px;
        border: 1px solid #bbb;
        border-radius: 6px;
        box-sizing: border-box;
      }
      .unit,
      .control select.unit {
        flex: 0 0 auto;
        min-width: 84px;
        padding: 4px;
        border: 1px solid #bbb;
        border-radius: 6px;
        background: inherit;
        white-space: nowrap;
        box-sizing: border-box;
      }
      .val {
        flex: 1 1 auto;
        min-width: 0;
        padding: 4px;
        border: 1px solid #bbb;
        border-radius: 6px;
        background: inherit;
        box-sizing: border-box;
      }
      .control + .control {
        margin-top: 5px;
      }
    </style>
    <meta name="color-scheme" content="light dark" />
    <meta name="description" content="Honeycomb Core Thermal Conductivity Calculator" />
    <meta name="robots" content="noindex" />
    <base target="_top" />
    <script>
      // Prevent layout shifts on first paint in some embeds
      document.documentElement.style.visibility = 'hidden';
      window.addEventListener('DOMContentLoaded', () => {
        document.documentElement.style.visibility = '';
      });
    </script>
  </head>
  <body>
    <form id="calc" novalidate>
      <fieldset>
        <legend>Input</legend>
        <div class="control">
          <label for="altitude">Geometric Height</label>
          <input
            id="altitude"
            type="number"
            step="any"
            min="0"
            value="0"
            aria-describedby="altitude"
          />
          <select id="altitude" class="unit">
            <option value="m" selected>m</option>
            <option value="km">km</option>
            <option value="feet">feet</option>
          </select>
        </div>
      </fieldset>

      <fieldset>
        <legend>Output</legend>
        <div class="control">
          <label for="geopotential_height">Geopotential Height</label>
          <div class="val"><output id="out_kG" aria-live="polite">—</output></div>
          <div class="unit">m</div>
        </div>
        <div class="control">
          <label for="temperature">Temperature</label>
          <div class="val"><output id="out_kH" aria-live="polite">—</output></div>
          <div class="unit">°C</div>
        </div>
        <div class="control">
          <label for="pressure">Pressure</label>
          <div class="val"><output id="out_kL" aria-live="polite">—</output></div>
          <div class="unit">Pa</div>
        </div>
        <div class="control">
          <label for="density">Density</label>
          <div class="val"><output id="out_kR" aria-live="polite">—</output></div>
          <div class="unit">kg/m³</div>
        </div>
        <div class="control">
          <label for="viscosity">Dynamic Viscosity</label>
          <div class="val"><output id="out_kM" aria-live="polite">—</output></div>
          <div class="unit">Pa·s</div>
        </div>
        <div class="control">
          <label for="kinematic_viscosity">Kinematic Viscosity</label>
          <div class="val"><output id="out_kN" aria-live="polite">—</output></div>
          <div class="unit">m²/s</div>
        </div>
        <div class="control">
          <label for="thermal_conductivity">Thermal Conductivity</label>
          <div class="val"><output id="out_kK" aria-live="polite">—</output></div>
          <div class="unit">W/(m·K)</div>
        </div>
      </fieldset>
    </form>

    <script>
      (function () {
        const $ = s => document.querySelector(s);

        // Physical constants (SI units)
        const GRAVITY = 9.80665; // m/s^2
        const MOLAR_MASS = 0.0289644; // kg/mol
        const GAS_CONSTANT = 8.31447; // J/(mol*K)
        const RADIUS = 6356766;

        // Unit conversion
        function toMeters(v, unit) {
          if (!Number.isFinite(v)) return NaN;
          switch (unit) {
            case 'm':
              return v;
            case 'km':
              return v * 1000;
            case 'feet':
              return v * 0.3048;
            default:
              return NaN;
          }
        }

        // Formatting helper
        function fmt(x) {
          return Number.isFinite(x) ? x.toPrecision(5) : '—';
        }

        // U.S. Standard Atmosphere 1976 pressure (Pa) at altitude h (m)
        function atmospherePressure(h) {
          if (!Number.isFinite(h)) return NaN;
          if (h < 0 || h > 80000) {
            console.warn('Altitude is out of valid range [0, 84852] m.');
            return NaN;
          }
          if (h < 11000) return p0(h);
          if (h < 20000) return p1(h);
          if (h < 32000) return p2(h);
          if (h < 47000) return p3(h);
          if (h < 51000) return p4(h);
          if (h < 71000) return p5(h);
          return p6(h); // up to 80000 m
        }

        function p0(h) {
          const L = -0.0065;
          const T = 15.0 + 273.15;
          const P = 101325.0;
          const Hb = 0.0;
          return P * Math.pow(T / (T + L * (h - Hb)), (GRAVITY * MOLAR_MASS) / (GAS_CONSTANT * L));
        }
        function p1(h) {
          const L = 0.0;
          const T = -56.5 + 273.15;
          const Hb = 11000.0;
          const P = 22632.0; // p0(Hb);
          return P * Math.exp((-GRAVITY * MOLAR_MASS * (h - Hb)) / (GAS_CONSTANT * T));
        }
        function p2(h) {
          const L = 0.001;
          const T = -56.5 + 273.15;
          const Hb = 20000.0;
          const P = 5474.87; // p1(Hb);
          return P * Math.pow(T / (T + L * (h - Hb)), (GRAVITY * MOLAR_MASS) / (GAS_CONSTANT * L));
        }
        function p3(h) {
          const L = 0.0028;
          const T = -44.5 + 273.15;
          const Hb = 32000.0;
          const P = 868.014; // p2(Hb);
          return P * Math.pow(T / (T + L * (h - Hb)), (GRAVITY * MOLAR_MASS) / (GAS_CONSTANT * L));
        }
        function p4(h) {
          const L = 0.0;
          const T = -2.5 + 273.15;
          const Hb = 47000.0;
          const P = 110.906; // p3(Hb);
          return P * Math.exp((-GRAVITY * MOLAR_MASS * (h - Hb)) / (GAS_CONSTANT * T));
        }
        function p5(h) {
          const L = -0.0028;
          const T = -2.5 + 273.15;
          const Hb = 51000.0;
          const P = 66.9384; // p4(Hb);
          return P * Math.pow(T / (T + L * (h - Hb)), (GRAVITY * MOLAR_MASS) / (GAS_CONSTANT * L));
        }
        function p6(h) {
          const L = -0.002;
          const T = -58.5 + 273.15;
          const Hb = 71000.0;
          const P = 3.95639; // p5(Hb);
          return P * Math.pow(T / (T + L * (h - Hb)), (GRAVITY * MOLAR_MASS) / (GAS_CONSTANT * L));
        }

        // U.S. Standard Atmosphere 1976 temperature (°C) at altitude h (m)
        function atmosphereTemperature(h) {
          if (!Number.isFinite(h)) return NaN;
          if (h < 0 || h > 80000) {
            console.warn('Altitude is out of valid range [0, 80000] m.');
            return NaN;
          }
          if (h <= 11000.0) return 15.0 - 0.0065 * h;
          if (h <= 20000.0) return -56.5;
          if (h <= 32000.0) return -56.5 + 0.001 * (h - 20000.0);
          if (h <= 47000.0) return -44.5 + 0.0028 * (h - 32000.0);
          if (h <= 51000.0) return -2.5;
          if (h <= 71000.0) return -2.5 - 0.0028 * (h - 51000.0);
          if (h <= 80000.0) return -58.5 - 0.002 * (h - 71000.0);
          return NaN;
        }

        function update() {
          // Selectors: input#altitude and select#altitude (ids are duplicated; target by tag)
          const altInput = document.querySelector('input#altitude');
          const unitSelect = document.querySelector('select#altitude');

          const raw = parseFloat(altInput?.value);
          const unit = unitSelect?.value || 'm';
          const z = toMeters(raw, unit);
          const h = (RADIUS * z) / (RADIUS + z); // Geopotential height

          const T = atmosphereTemperature(h);
          const P = atmospherePressure(h);
          const rho = (P * MOLAR_MASS) / (GAS_CONSTANT * (T + 273.15)); // kg/m^3
          const mu = (1.458e-6 * Math.pow(T + 273.15, 1.5)) / (T + 273.15 + 110.4); // Sutherland's formula, Pa·s
          const nu = mu / rho; // m^2/s
          const k =
            (2.64638e-3 * Math.pow(T + 273.15, 1.5)) /
            (T + 273.15 + 245.4 * Math.pow(10, -12.0 / (T + 273.15))); // Sutherland's formula, W/(m·K)

          $('#out_kG').textContent = fmt(h);
          $('#out_kH').textContent = fmt(T);
          $('#out_kL').textContent = fmt(P);
          $('#out_kR').textContent = fmt(rho);
          $('#out_kM').textContent = fmt(mu);
          $('#out_kN').textContent = fmt(nu);
          $('#out_kK').textContent = fmt(k);
        }

        document.querySelectorAll('input, select').forEach(el => {
          el.addEventListener('input', update);
          el.addEventListener('change', update);
        });
        update();
      })();
    </script>
  </body>
</html>
